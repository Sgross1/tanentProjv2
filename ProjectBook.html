<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ספר פרויקט - KaLiScore</title>
    <!-- Mermaid via CDN -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral', direction: 'rtl' });
    </script>
    <style>
        :root {
            --primary-color: #0E4C92;
            --secondary-color: #00B4D8;
            --accent-turquoise: #1ABC9C;
            --accent-gray: #BDC3C7;
            --bg-color: #ffffff;
            --section-bg: #f8fcfd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
            line-height: 1.6;
            counter-reset: page;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            padding: 25mm 20mm 20mm 20mm;
            margin: 10mm auto;
            background: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border-top: 10px solid var(--primary-color);
            page-break-after: always;
            box-sizing: border-box;
        }

        @media print {
            body {
                background: none;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .page {
                margin: 0 auto;
                width: 100%;
                /* Allow height to be flexible but at least A4 */
                min-height: 297mm;
                height: auto !important;
                overflow: visible !important;

                box-shadow: none;
                border: none;
                padding: 15mm;
                page-break-after: always;

                /* Scale down slightly to ensure all content fits within printer margins */
                transform: scale(0.97);
                transform-origin: top center;
            }

            .page-footer {
                position: absolute;
                bottom: 10mm;
                left: 0;
                right: 0;
            }

            .no-print {
                display: none;
            }

            @page {
                margin: 0;
                size: A4 portrait;
            }
        }

        .page-footer {
            position: absolute;
            bottom: 12mm;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 11pt;
            color: #555;
            font-weight: bold;
            border-top: 2px solid var(--secondary-color);
            padding-top: 10px;
            background: white;
        }

        h1 {
            color: var(--primary-color);
            font-size: 22pt;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 30px;
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
        }

        h2 {
            color: var(--primary-color);
            font-size: 16pt;
            border-right: 6px solid var(--secondary-color);
            padding-right: 15px;
            margin-top: 40px;
            background: linear-gradient(90deg, #f9f9f9 0%, #fff 100%);
            padding: 10px 20px 10px 0;
        }

        h3 {
            color: #0077B6;
            font-size: 13pt;
            font-weight: bold;
            margin-top: 25px;
        }

        p,
        li,
        td {
            text-align: justify;
            font-size: 11pt;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 10pt;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }

        th {
            background-color: var(--primary-color);
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Images and Diagrams */
        .screenshot-container {
            text-align: center;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid #eee;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .screenshot-container img {
            max-width: 98%;
            /* Removed crop */
        }

        .full-page-diagram {
            width: 100%;
            max-height: 220mm;
            object-fit: contain;
            display: block;
            margin: 20px auto;
        }

        /* Cover Page */
        .cover-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            position: relative;
            z-index: 2;
        }


        .cover-logo img {
            width: 320px;
            margin-bottom: 20px;
        }

        .cover-title {
            font-size: 56pt;
            font-weight: 900;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        .cover-subtitle {
            font-size: 24pt;
            color: var(--accent-gray);
            margin-bottom: 40px;
            font-weight: 300;
        }

        .cover-details {
            margin-top: 40px;
            font-size: 14pt;
            padding: 20px 40px;
            border-right: 5px solid var(--secondary-color);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: right;
            display: inline-block;
        }

        /* Cover Decoration Lines */
        .cover-deco-bar {
            position: absolute;
            left: 0;
            width: 100%;
            height: 15px;
        }

        .bar-top {
            top: 0;
            background: var(--primary-color);
        }

        .bar-top-2 {
            top: 15px;
            background: var(--secondary-color);
            height: 10px;
        }

        .bar-bottom {
            bottom: 0;
            background: var(--primary-color);
            height: 20px;
        }

        .bar-bottom-2 {
            bottom: 20px;
            background: var(--accent-turquoise);
            height: 10px;
        }

        .cover-shape {
            position: absolute;
            z-index: 1;
            opacity: 0.1;
        }

        /* .shape-circle removed */
        .shape-rect {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--bg-color) 0%, #EBF5FB 100%);
            bottom: 100px;
            left: 0;
            transform: skewY(-3deg);
        }

        /* Code */
        pre.full-code {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 15px;
            border-radius: 5px;
            direction: ltr;
            text-align: left;
            font-family: Consolas, monospace;
            font-size: 8.5pt;
            height: 200mm;
            overflow: hidden;
            white-space: pre-wrap;
        }

        .toc-list {
            list-style: none;
            padding: 0;
        }

        .toc-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            border-bottom: 2px solid #333;
            padding: 10px 0;
            margin-bottom: 10px;
            font-size: 14pt;
        }

        .toc-item {
            border-bottom: 1px dashed #bbb;
            padding: 6px 0;
            font-size: 12pt;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toc-item a {
            text-decoration: none;
            color: #333;
            flex-grow: 1;
        }

        .toc-page-num {
            font-weight: bold;
            padding-left: 10px;
        }

        /* Mermaid Fix for RTL */
        .mermaid {
            text-align: center;
            direction: ltr;
        }

        /* Gallery Pages (Screenshots) */
        .gallery-page {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
        }

        .gallery-page h3 {
            margin-top: 0;
            width: 100%;
            text-align: right;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .gallery-page .screenshot-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-height: 40%;
            /* Ensure 2 fit */
            margin: 10px 0;
            border: none;
            box-shadow: none;
        }

        .gallery-page .screenshot-container img {
            max-height: 90%;
            object-fit: contain;
            /* Remove crop for gallery generic images if needed, or keep consistent */
            margin: 0 auto;
            clip-path: none;
        }

        /* Fix for Proposal Page Print */
        @media print {
            #page-proposal h2 {
                margin-top: 0;
            }

            #page-proposal img {
                max-height: 230mm !important;
                width: auto !important;
                max-width: 100%;
                display: block;
            }
        }
    </style>
</head>

<body>

    <!-- PAGE 1: COVER -->
    <div class="page" id="page-cover"
        style="padding: 0; overflow: hidden; display: flex; align-items: center; justify-content: center;">
        <div class="cover-deco-bar bar-top"></div>
        <div class="cover-deco-bar bar-top-2"></div>
        <div class="cover-shape shape-rect"></div>

        <div class="cover-page">
            <div class="cover-logo"><img src="./ort_logo.WEBP" alt="לוגו אורט"></div>
            <h2 style="border: none; background: none; margin: 0; padding: 0; font-size: 22pt;">מכללת אורט ירושלים</h2>
            <div class="cover-title">KaLiScore</div>
            <div class="cover-subtitle">אפליקציית דירוג כלכלי לשוכרים</div>
            <div class="cover-details">
                <p><strong>מגישים:</strong> שלמה גרוס, עזריאל רויטמן</p>
                <p><strong>מנחה:</strong> שגיב טוביה</p>
                <p><strong>שנה:</strong> 2026</p>
                <p><strong>מסלול:</strong> הנדסאים</p>
                <p><strong>מגמה:</strong> תוכנה</p>
            </div>
        </div>

        <div class="cover-deco-bar bar-bottom-2"></div>
        <div class="cover-deco-bar bar-bottom"></div>
        <div class="page-footer" style="background: none; border: none; bottom: 40px; color: white;">עמוד 1</div>
    </div>

    <!-- PAGE 2: PROPOSAL -->
    <div class="page" id="page-proposal">
        <h2 style="text-align: center;">הצעה לפרויקט גמר</h2>
        <div style="text-align: center;"><img src="./proposal.png" style="width: 100%; border: 1px solid #ccc;"></div>
        <div class="page-footer">עמוד 2</div>
    </div>

    <!-- PAGE 3: TOC -->
    <div class="page" id="page-toc">
        <h1>תוכן העניינים</h1>
        <div class="toc-header">
            <span>נושא</span>
            <span>עמוד</span>
        </div>
        <ul class="toc-list">
            <li class="toc-item"><a href="#1">1. תאור ורקע כללי</a><span class="toc-page-num">4</span></li>
            <li class="toc-item"><a href="#2">2. מטרות המערכת</a><span class="toc-page-num">4</span></li>
            <li class="toc-item"><a href="#3">3. סקירת מצב קיים בשוק</a><span class="toc-page-num">4</span></li>
            <li class="toc-item"><a href="#4">4. מה הפרויקט אמור לחדש</a><span class="toc-page-num">4</span></li>
            <li class="toc-item"><a href="#5">5. דרישות מערכת ופונקציונאליות</a><span class="toc-page-num">5</span></li>
            <li class="toc-item"><a href="#6">6. בעיות צפויות ופתרונות</a><span class="toc-page-num">6</span></li>
            <li class="toc-item"><a href="#7">7. פתרון טכנולוגי נבחר</a><span class="toc-page-num">7</span></li>
            <li class="toc-item"><a href="#8">8. שימוש במבני נתונים וארגון קבצים (DB)</a><span
                    class="toc-page-num">9</span></li>
            <li class="toc-item"><a href="#9">9. תרשימי מערכת מרכזיים</a><span class="toc-page-num">11</span></li>
            <li class="toc-item"><a href="#10">10. תיאור המרכיב האלגוריתמי חישובי</a><span
                    class="toc-page-num">18</span></li>
            <li class="toc-item"><a href="#11">11. תיאור/התייחסות לנושאי אבטחת מידע</a><span
                    class="toc-page-num">19</span></li>
            <li class="toc-item"><a href="#12">12. משאבים הנדרשים לפרויקט</a><span class="toc-page-num">20</span></li>
            <li class="toc-item"><a href="#13">13. תכנית עבודה וניהול הפרויקט</a><span class="toc-page-num">21</span>
            </li>
            <li class="toc-item"><a href="#14">14. תכנון הבדיקות שיבוצעו</a><span class="toc-page-num">22</span></li>
            <li class="toc-item"><a href="#15">15. בקרת גרסאות</a><span class="toc-page-num">23</span></li>
            <li class="toc-item"><a href="#appendix">נספחים (דוגמאות קוד)</a><span class="toc-page-num">24</span></li>
        </ul>
        <div class="page-footer">עמוד 3</div>
    </div>

    <!-- CONTENT START -->
    <div class="page">
        <h1 id="1">1. תאור ורקע כללי</h1>
        <p>שוק השכירות בישראל מאופיין בחוסר וודאות קיצוני. בעוד מחירי הדיור עולים, בעלי הדירות (המשכירים) חוששים להשכיר
            את נכסיהם לדיירים שאין ביכולתם לעמוד בתשלומים או שעלולים לגרום נזק. כיום, אין בישראל מנגנון מרכזי ואמין
            דוגמת FICO האמריקאי לדירוג אשראי של שוכרים פרטיים.</p>
        <p>מערכת <strong>KaLiScore</strong> נועדה לגשר על הפער הזה באמצעות טכנולוגיה. המערכת מספקת פלטפורמה אובייקטיבית
            המנתחת את יכולותיו הפיננסיות של השוכר ומפיקה עבורו "תעודת יושר פיננסית" אותה יוכל להציג לבעלי דירות.</p>

        <h1 id="2">2. מטרות המערכת</h1>
        <ul>
            <li>מתן כלי אובייקטיבי למשכירים לסינון דיירים.</li>
            <li>העצמת שוכרים טובים באמצעות הוכחת יכולת תשלום (Power to the Tenant).</li>
            <li>הפחתת החיכוך הבירוקרטי (איסוף ידני של תלושים ותדפיסי בנק).</li>
            <li>יצירת סטנדרט חדש בשוק השכירות הישראלי.</li>
        </ul>

        <h1 id="3">3. סקירת מצב קיים בשוק</h1>
        <p>כיום, שוק השכירות מתנהל בצורה "פיראטית" כמעט. אין מאגר נתונים מרכזי. קיימים פתרונות חלקיים:</p>
        <ul>
            <li><strong>WeCheck:</strong> מבצעת בדיקות רקע, אך השירות יקר ומיועד בעיקר למתווכים.</li>
            <li><strong>BDI/דן אנד ברדסטריט:</strong> מספקות דוחות אשראי שליליים ("אורות אדומים"), אך לא נותנות ציון
                חיובי שמאפשר לשוכר להתבלט.</li>
            <li><strong>פייסבוק/יד2:</strong> לוחות מודעות ללא סינון איכותי.</li>
        </ul>

        <h1 id="4">4. מה הפרויקט אמור לחדש</h1>
        <p>החידוש העיקרי הוא <strong>הפוזיטיביות</strong> וה-<strong>אוטומציה</strong>. במקום לחפש "מי לא שילם", אנו
            מחפשים "מי יכול לשלם".</p>
        <ul>
            <li>שימוש ב-AI (Azure Document Intelligence) לקריאת תלושי שכר בזמן אמת.</li>
            <li>אלגוריתם הלוקח בחשבון פרמטרים כמו ותק, פנסיה וגודל משפחה.</li>
            <li>חווית משתמש (UX) מודרנית ואינטראקטיבית.</li>
        </ul>
        <div class="page-footer">עמוד 4</div>
    </div>

    <div class="page" id="5">
        <h1>5. דרישות מערכת ופונקציונאליות</h1>

        <h3>5.1 סביבת הטמעה ושימוש שרידות, ביצועים והתמודדות עם עומסים</h3>
        <p>המערכת מתוכננת כ-Web Application הפועלת בענן (Cloud Native). דרישות הליבה:</p>
        <ul>
            <li><strong>זמינות:</strong> 99.9% Up-time. שרתים יתירים (Redundancy).</li>
            <li><strong>ביצועים:</strong> זמן תגובה ממוצע של עד 2 שניות (למעט תהליך ה-OCR). תהליכים א-סינכרוניים עבור
                פעולות כבדות.</li>
        </ul>

        <h3>5.2 דרישות פונקציונאליות (רשימת דרישות)</h3>
        <ol>
            <li><strong>מודול שוכר:</strong>
                <ul>
                    <li>רישום והתחברות (כולל אימות מייל).</li>
                    <li>העלאת 3 תלושי שכר (PDF/תמונה).</li>
                    <li>צפייה בסטטוס הדירוג בזמן אמת.</li>
                    <li>קבלת ציון סופי ויכולת שיתוף.</li>
                </ul>
            </li>
            <li><strong>מודול משכיר:</strong>
                <ul>
                    <li>חיפוש שוכרים לפי פרמטרים (ציון מינימלי, עיר, טווח הכנסה).</li>
                    <li>שמירת שוכרים למועדפים.</li>
                    <li>פנייה עצמאית לשוכרים.</li>
                    <li>אימות זהות השוכר לפני ביצוע עסקה.</li>
                </ul>
            </li>
            <li><strong>מודול אדמין:</strong>
                <ul>
                    <li>ניהול משתמשים (חסימה/הסרה).</li>
                    <li>צפייה בסטטיסטיקות של המערכת.</li>
                    <li>ניהול פניות ותמיכה טכנית.</li>
                </ul>
            </li>
        </ol>
        <div class="page-footer">עמוד 5</div>
    </div>



    <div class="page" id="6">
        <h1>6. בעיות צפויות ופתרונות</h1>

        <h3>6.1 תיאור הבעיות (תפעוליות, טכנולוגיות, עומס)</h3>
        <ol>
            <li><strong>פענוח שגוי של מסמכים (OCR):</strong> תלושי שכר מגיעים בפורמטים לא אחידים או צילומים מטושטשים.
                הדבר עלול להוביל לנתונים שגויים.</li>
            <li><strong>איטיות בעיבוד:</strong> שליחת קבצים כבדים ל-Azure AI עלולה לקחת זמן ולגרום ל-Timeout בצד הלקוח.
            </li>
            <li><strong>אבטחת מידע ופרטיות:</strong> המערכת שומרת מידע רגיש מאוד (שכר, ת"ז). פריצה למאגר תהיה הרסנית.
            </li>
        </ol>

        <h3>6.2 פתרונות אפשריים (חלופות ארכיטקטוניות)</h3>
        <table style="width:100%">
            <tr>
                <th>הבעיה</th>
                <th>הפתרון הטכנולוגי הנבחר</th>
            </tr>
            <tr>
                <td>דיוק OCR</td>
                <td>שימוש בכלי Document-Intelligence של Azure עם מודול שאומן ספציפית על תלושים ישראליים (Custom Models).
                </td>
            </tr>
            <tr>
                <td>Latency \ איטיות</td>
                <td>שימוש בתכנות א-סינכרוני (async/await) המאפשר לשרת לטפל במספר רב של בקשות במקביל מבלי "לתקוע" משאבים,
                    בשילוב עם מחוון טעינה (Loading Spinner) בלקוח לחווית משתמש רציפה.</td>
            </tr>
            <tr>
                <td>אבטחת פרטיות</td>
                <td>הצפנת נתונים במנוחה (Encryption at Rest) ב-DB. מחיקת קבצי המקור מהשרת מיד לאחר העיבוד ושמירת הנתונים
                    המעובדים בלבד.</td>
            </tr>
        </table>
        <div class="page-footer">עמוד 6</div>
    </div>

    <div class="page">
        <h1>7. פתרון טכנולוגי נבחר</h1>

        <h3>7.1 טופולוגיית הפתרון</h3>
        <p>ארכיטקטורת Client-Server מודרנית (N-Tier Architecture).</p>

        <h3>7.2 טכנולוגיות בשימוש</h3>
        <ul>
            <li><strong>Client:</strong> Angular 16, Three.js (ויזואליזציה).</li>
            <li><strong>Server:</strong> .NET 8.0 Web API.</li>
            <li><strong>Database:</strong> SQL Server / SQLite (לפיתוח).</li>
            <li><strong>Cloud Services:</strong> Azure Document Intelligence (OCR).</li>
        </ul>

        <h3>7.3 שפות הפיתוח</h3>
        <ul>
            <li>C# (Backend)</li>
            <li>TypeScript, HTML, SCSS (Frontend)</li>
            <li>SQL (Data Layer)</li>
        </ul>

        <h3>7.4 תיאור הארכיטקטורה הנבחרת</h3>
        <p>נבחרה ארכיטקטורת שכבות (Layered Architecture) המפרידה בבירור בין:</p>
        <ul>
            <li><strong>Controller Layer:</strong> נקודות קצה API.</li>
            <li><strong>Service Layer:</strong> לוגיקה עסקית (חישובי דירוג).</li>
            <li><strong>Repository Layer:</strong> גישה לנתונים.</li>
        </ul>

        <h3>7.6 סביבת השרת</h3>
        <p>השרת הוא RESTful API Stateless. ניהול הזדהות מבוצע באמצעות JWT Tokens. הפרוטוקול בייצור הוא HTTPS (מאובטח),
            בעוד בפיתוח נעשה שימוש ב-HTTP לנוחות.</p>

        <div class="page-footer">עמוד 7</div>
    </div>

    <div class="page">
        <h3>7.7 ממשק המשתמש/לקוח GUI</h3>
        <p>ממשק המשתמש נבנה באמצעות Angular 16, תוך שימוש ברכיבי Material Design למראה אחיד ומקצועי. הממשק הוא רספונסיבי
            (Responsive Web Design) ומותאם לשימוש הן במחשב נייח והן במכשירים ניידים.</p>

        <h3>7.8 ממשקים למערכות אחרות API</h3>
        <p>המערכת מתקשרת עם השירותים החיצוניים הבאים:</p>
        <ul>
            <li><strong>Azure Document Intelligence:</strong> ממשק REST API לשליחת קבצים וקבלת נתוני OCR.</li>
            <li><strong>City Gov IL:</strong> ממשק לקבלת רשימת ערים מעודכנת בישראל.</li>
            <li><strong>Resend:</strong> ממשק לשליחת מיילים טרנזקציוניים (התראות ואיפוסי סיסמה).</li>
        </ul>

        <h3>7.9 שימוש בחבילות תוכנה</h3>
        <p>הפרויקט עושה שימוש בחבילות צד-שלישי לחיסכון בזמן פיתוח:</p>
        <ul>
            <li><strong>Backend (NuGet):</strong> Serilog (לוגים), BCrypt (הצפנה), EF Core (מסד נתונים).</li>
            <li><strong>Frontend (NPM):</strong> Ngx-Charts (גרפים), Bootstrap (עיצוב), Three.js (ויזואליזציה בתלת
                מימד).</li>
        </ul>
        <div class="page-footer">עמוד 8</div>
    </div>

    <div class="page" id="8">
        <h1>8. שימוש במבני נתונים וארגון קבצים (DB)</h1>

        <h3>8.1 פירוט מבנה הנתונים</h3>
        <p>טבלאות המערכת העיקריות:</p>
        <ul>
            <li><strong>Users:</strong> מזהה, אימייל, סיסמה (Hash), תפקיד.</li>
            <li><strong>Requests:</strong> בקשות דירוג, הכנסה נטו, ותק, ציון סופי, תאריך יצירה.</li>
            <li><strong>SavedTenants:</strong> טבלת קשר רבים-לרבים בין משכירים לשוכרים מועדפים.</li>
        </ul>

        <div class="mermaid" style="transform: scale(1.1); transform-origin: center top; margin-bottom: 20mm;">
            erDiagram
            USERS ||--o{ REQUESTS : creates
            USERS ||--o{ SAVED_TENANTS : saves

            USERS {
            int Id PK
            string Username
            string Email
            string PasswordHash
            string Role
            }

            REQUESTS {
            int Id PK
            int UserId FK
            decimal MonthlyIncome
            int EmploymentMonths
            int Score

            datetime CreatedAt
            }

            SAVED_TENANTS {
            int LandlordId FK
            int TenantId FK
            datetime SavedAt
            }
        </div>
        <div class="page-footer">עמוד 9</div>
    </div>

    <div class="page">
        <br><br><br>

        <h3>8.2 שיטת האחסון (מאגר נתונים, קבצים, ובאיזה טכנולוגיה)</h3>
        <p>הנתונים נשמרים במאגר נתונים רלאציוני (RDBMS).</p>
        <ul>
            <li><strong>טכנולוגיה:</strong> בסביבת הפיתוח LocalDB/SQLite ובייצור SQL Server.</li>
            <li><strong>קבצים:</strong> קבצי המשתמש (תלושי שכר) נשמרים זמנית בזיכרון RAM (Memory Stream) לצורך עיבוד
                OCR ונמחקים מיד לאחר מכן מטעמי אבטחה, ללא שמירה קבועה בדיסק.</li>
        </ul>

        <h3>8.3 מנגנוני התאוששות מנפילה</h3>
        <p>בסביבת הפיתוח נעשה שימוש ב-SQLite (קובץ מקומי) ובייצור ב-SQL Server. המערכת תומכת בתהליכי גיבוי ושחזור,
            ושמירה על עקביות נתונים (ACID) באמצעות טרנזקציות.</p>
        <div class="page-footer">עמוד 10</div>
    </div>

    <div class="page" id="9">
        <h1>9. תרשימי מערכת מרכזיים</h1>

        <h3>9.1 Use Case (תרשים שימוש)</h3>
        <p>המערכת משרתת שלושה סוגי משתמשים עיקריים, ולכל אחד מהם סט פעולות ייעודי:</p>
        <ul>
            <li><strong>שוכר (Tenant):</strong> מבצע הרשמה, מעלה מסמכים לדירוג, צופה בתוצאה הסופית, ומעדכן פרופיל אישי.
            </li>
            <li><strong>משכיר (Landlord):</strong> מחפש שוכרים לפי קריטריונים (ציון/עיר), מוסיף שוכרים למועדפים, ויוצר
                קשר.</li>
            <li><strong>מנהל מערכת (Admin):</strong> צופה בסטטיסטיקות כניסה ושימוש, ומנהל משתמשים (חסימה/איפוס).</li>
        </ul>

        <h3>9.2 Sequence Diagram (תהליך הדירוג)</h3>
        <div class="mermaid">
            sequenceDiagram
            participant T as שוכר (UI)
            participant S as שרת (API)
            participant A as שירות AI
            participant D as בסיס נתונים

            T->>S: העלאת קבצי תלושים
            activate S
            S->>A: שלח קבצים לפענוח
            activate A
            A-->>S: החזר נתוני JSON (שכר, ותק)
            deactivate A
            S->>S: חישוב ציון (אלגוריתם)
            S->>D: שמור בקשה וציון
            S-->>T: החזר תוצאה סופית
            deactivate S
        </div>

        <div class="page-footer">עמוד 11</div>
    </div>

    <!-- NEW PAGE 10: DATA FLOW -->
    <div class="page">
        <h3>9.3 Data Flow (זרימת משתמש כללית)</h3>
        <img src="./user_flow.jpeg" class="full-page-diagram" alt="Data Flow">
        <div class="page-footer">עמוד 12</div>
    </div>

    <!-- NEW SECTION 9.4: SCREENSHOTS (Pages 11-15) -->
    <div class="page gallery-page">
        <h3>9.4 צילומי מסך והסבר על הממשק</h3>
        <div class="screenshot-container">
            <img src="./homePage.jpeg" alt="דף הבית">
            <small>מסך הבית - כניסה למערכת</small>
        </div>
        <!-- <div class="screenshot-container">
            <img src="./loginRegister.jpeg" alt="הרשמה">
            <small>כרטיס כניסה והרשמה</small>
        </div> -->
        <div class="page-footer">עמוד 13</div>
    </div>

    <div class="page gallery-page">

        <h3>פתיחת פניה והעלאת מסמכים</h3>
        <div class="screenshot-container">
            <img src="./pniya.jpeg" alt="פניה חדשה">
            <small>יצירת פניה חדשה</small>
        </div>
        <div class="screenshot-container">
            <img src="./pniya2.jpeg" alt="העלאת מסמכים">
            <small>תהליך הדירוג - העלאת תלושי שכר</small>
        </div>
        <div class="page-footer">עמוד 14</div>
    </div>

    <div class="page gallery-page">
        <h3>חישוב וקבלת תוצאה</h3>
        <div class="screenshot-container">
            <img src="./pniya3.jpeg" alt="חישוב ציון">
            <small>תהליך הדירוג - חישוב הציון בזמן אמת</small>
        </div>
        <div class="screenshot-container">
            <img src="./tsiyun.jpeg" alt="תוצאה סופית">
            <!-- <small>מסך קבלת הציון הסופי</small> -->
        </div>
        <div class="page-footer">עמוד 15</div>
    </div>

    <div class="page gallery-page">
        <h3>אזור משכיר וחיפוש</h3>
        <div class="screenshot-container">
            <img src="./mascir.jpeg" alt="דף הבית למשכיר">
            <small>חיפוש שוכר</small>
        </div>
        <div class="screenshot-container">
            <img src="./ezor2.jpeg" alt="אזור אישי משכיר">
            <small>אזור אישי - משכיר</small>
        </div>
        <div class="page-footer">עמוד 16</div>
    </div>

    <div class="page gallery-page">
        <h3>אזור שוכר וניהול</h3>
        <div class="screenshot-container">
            <img src="./ezor1.jpeg" alt="אזור אישי שוכר">
            <small>אזור אישי - שוכר</small>
        </div>
        <div class="screenshot-container">
            <img src="./screen_admin.png" alt="ממשק ניהול">
            <small>ממשק ניהול - אדמיניסטרטור</small>
        </div>
        <div class="page-footer">עמוד 17</div>
    </div>

    <div class="page" id="10">
        <h1>10. תיאור המרכיב האלגוריתמי חישובי</h1>

        <h3>10.1 איזה בעיה בא לפתור ואיך יפתור?</h3>
        <p>הבעיה היא היעדר יכולת לנרמל נתונים גולמיים (שכר ברוטו/נטו משתנים) לציון אחד בר השוואה. הפתרון הוא אלגוריתם
            המבוסס על "כלל ה-30%" הכלכלי (Housing Burden).</p>

        <h3>10.2 מקורות וגופים כלכליים</h3>
        <p>האלגוריתם מתבסס על מחקרים ומתודולוגיות של הגופים הבאים:</p>
        <ul>
            <li><strong>OECD (הארגון לשיתוף פעולה ופיתוח כלכלי):</strong> אימוץ מדד "נטל הדיור" (Housing Cost
                Overburden), הקובע כי הוצאה על דיור מעל 40% מההכנסה הפנויה מוגדרת כסיכון פיננסי למשק הבית.</li>
            <li><strong>FICO (Fair Isaac Corporation):</strong> השראת המודל הלוגיסטי, אך התאמה לסקאלה פשוטה של 0-100
                המובנת יותר למשתמש הישראלי.</li>
            <li><strong>הלמ"ס (הלשכה המרכזית לסטטיסטיקה):</strong> שימוש בנתוני העשירונים (שנתון 2024) לצורך חישוב יחס
                ההכנסה ביחס לממוצע הארצי.</li>
            <li><strong>HUD (U.S. Dept. of Housing):</strong> אימוץ תקני ה-Area Median AMI לצורך שקלול פרמטרים של מיקום
                גיאוגרפי.</li>
        </ul>
        <h3>10.3 איסוף מידע וניתוח סטטיסטי</h3>
        <p>האלגוריתם שלנו אוסף את הנתונים הבאים ומעניק משקלים:</p>
        <ul>
            <li><strong>יחס הכנסה לשכר דירה (50%):</strong> הנוסחה בודקת האם שכר הדירה המבוקש מהווה פחות מ-35% מההכנסה
                הפנויה.</li>
            <li><strong>יציבות תעסוקתית (30%):</strong> מספר חודשי עבודה רצופים באותו מקום.</li>
            <li><strong>היסטוריה פנסיונית (20%):</strong> קיום הפרשות סדירות לפנסיה.</li>
        </ul>
        <p><strong>דוגמה לחישוב (ראו הרחבה בנספח 2):</strong></p>
        <pre dir="ltr" style="background:#f4f4f4; padding:10px;">
Score = (IncomeRatioScore * 0.5) + (TenureScore * 0.3) + (PensionScore * 0.2)
        </pre>
        <div class="page-footer">עמוד 18</div>
    </div>

    <div class="page" id="11">
        <h1>11. תיאור/התייחסות לנושאי אבטחת מידע</h1>
        <p>המערכת מיישמת הגנה רב-שכבתית (Defense in Depth):</p>
        <ul>
            <li><strong>בקרת גישה (Access Control):</strong> שימוש ב-JWT עם חתימה דיגיטלית. כל בקשה לשרת עוברת אימות
                (Authentication) ובדיקת הרשאות (Authorization).</li>
            <li><strong>אבטחת שרת:</strong> סגירת פורטים לא רלוונטיים, תמיכה בארכיטקטורת SSL/TLS (HTTPS) בייצור.</li>
            <li><strong>אבטחת מאגר מידע:</strong> הנתונים הרגישים (כמו תעודת זהות) מוצפנים, וסיסמאות נשמרות כ-Hash
                (BCrypt) ולא כטקסט גלוי.</li>
            <li><strong>אימות זהות (Identity Verification):</strong> מנגנון למניעת הונאות המבצע השוואה אוטומטית בין מספר
                הזהות שהוזן ידנית לבין מספר הזהות המופיע ע"ג תלוש השכר (OCR).</li>

        </ul>
        <div class="page-footer">עמוד 19</div>
    </div>

    <div class="page" id="12">
        <h1>12. משאבים הנדרשים לפרויקט</h1>

        <h3>12.1 שעות עבודה (הערכה)</h3>
        <table>
            <tr>
                <th>שלב</th>
                <th>שעות</th>
            </tr>
            <tr>
                <td>מחקר וניתוח דרישות</td>
                <td>90</td>
            </tr>
            <tr>
                <td>עיצוב ותכנון ארכיטקטורה</td>
                <td>70</td>
            </tr>
            <tr>
                <td>פיתוח צד שרת (Backend)</td>
                <td>90</td>
            </tr>
            <tr>
                <td>פיתוח צד לקוח (Frontend)</td>
                <td>80</td>
            </tr>
            <tr>
                <td>בדיקות ואינטגרציה</td>
                <td>70</td>
            </tr>
            <tr>
                <td><strong>סה"כ</strong></td>
                <td><strong>400</strong></td>
            </tr>
        </table>

        <h3>12.2 ציוד ותוכנה</h3>
        <ul>
            <li><strong>סביבת פיתוח:</strong> Visual Studio 2022, VS Code.</li>
            <li><strong>מחשוב ענן:</strong> חשבון Azure סטודנטיאלי (עבור שירותי AI).</li>
            <li><strong>שירותי מייל:</strong> חשבון Resend לשליחת הודעות מערכת (איפוסי סיסמה, עדכוני ציון).</li>
            <li><strong>ניהול קוד:</strong> Git & GitHub.</li>
        </ul>

        <h3>12.3 תוכנות נדרשות</h3>
        <ul>
            <li>Visual Studio / VS Code (חובה)</li>
            <li>Git SCM (לניהול גרסאות)</li>
            <li>Node.js LTS & NPM (להרצת Angular)</li>
            <li>.NET 8.0 SDK (להרצת השרת)</li>
            <li>SQL Server Management Studio (SSMS) (לניהול ה-DB)</li>
        </ul>
        <div class="page-footer">עמוד 20</div>
    </div>

    <div class="page" id="13">

        <h3>12.4 ידע חדש שנדרש ללמוד לצורך ביצוע הפרויקט</h3>
        <p>במסגרת הפרויקט, נדרש צוות הפיתוח ללמוד נושאים טכנולוגיים מתקדמים:</p>
        <ul>
            <li>אינטגרציה עם שירותי ענן (Azure Document Intelligence) וקריאות HTTP מאובטחות.</li>
            <li>כתיבת אפליקציות SPA מורכבות באמצעות Angular 16 (Signals, Standalone Components).</li>
            <li>שימוש בספריות גרפיקה תלת-ממדית (Three.js) להעשרת חווית המשתמש.</li>
        </ul>

        <h3>12.5 ספרות ומקורות מידע</h3>
        <ul>
            <li><strong>Angular Docs:</strong> angular.io/docs</li>
            <li><strong>Microsoft Learn (.NET):</strong> learn.microsoft.com</li>
            <li><strong>OECD Housing Database:</strong> oecd.org/housing</li>
        </ul>

        <br>
        <br>
        <br>
        <br>

        <h1>13. תכנית עבודה ושלבים למימוש הפרויקט</h1>
        <table>
            <tr>
                <th>מס'</th>
                <th>שלב בפרויקט</th>
                <th>תיאור הפעילות</th>
                <th>משך זמן</th>
            </tr>
            <tr>
                <td>1.</td>
                <td>ייזום ותכנון</td>
                <td>הגדרת דרישות, כתיבת ספר פרויקט, עיצוב מסכים (Mockups)</td>
                <td>שבועיים</td>
            </tr>
            <tr>
                <td>2.</td>
                <td>הקמת תשתית</td>
                <td>יצירת פרויקט Angular ו-.NET, הקמת DB, הגדרת Git</td>
                <td>שבוע</td>
            </tr>
            <tr>
                <td>3.</td>
                <td>פיתוח צד שרת</td>
                <td>מימוש Controllers, Services, חיבור ל-OCR, ניהול משתמשים</td>
                <td>3. שבועות</td>
            </tr>
            <tr>
                <td>4.</td>
                <td>פיתוח צד לקוח</td>
                <td>בניית קומפוננטות, טפסים, Wizrad, חיבור ל-API</td>
                <td>4. שבועות</td>
            </tr>
            <tr>
                <td>5.</td>
                <td>בדיקות ותיקונים</td>
                <td>בדיקות קצה-לקצה, בדיקות יחידה, תיקון באגים</td>
                <td>שבועיים</td>
            </tr>
        </table>
        <div class="page-footer">עמוד 21</div>
    </div>

    <div class="page" id="14">
        <h1>14. תכנון הבדיקות שיבוצעו</h1>

        <h3>14.1 בדיקות תהליכיות (Full Flow System Tests)</h3>
        <table>
            <tr>
                <th>מזהה</th>
                <th>תיאור הבדיקה</th>
                <th>קלט מצופה</th>
                <th>תוצאה רצויה</th>
            </tr>
            <tr>
                <td>ST-01</td>
                <td>רישום משתמש חדש</td>
                <td>מייל תקין, סיסמה חזקה</td>
                <td>יצירת משתמש ב-DB, קבלת Token, הפניה לדשבורד</td>
            </tr>
            <tr>
                <td>ST-02</td>
                <td>העלאת קובץ לא תקין</td>
                <td>קובץ EXE או תמונה ריקה</td>
                <td>הודעת שגיאה "פורמט לא נתמך" בצד הלקוח</td>
            </tr>
            <tr>
                <td>ST-03</td>
                <td>חישוב דירוג מלא</td>
                <td>3. תלושי שכר תקינים</td>
                <td>קבלת ציון בין 0 ל-100</td>
            </tr>
        </table>

        <h3>14.2 בדיקות יחידה (Unit Tests)</h3>
        <table>
            <tr>
                <th>מודול</th>
                <th>מה נבדק?</th>
                <th>חשיבות</th>
            </tr>
            <tr>
                <td>ScoringService</td>
                <td>וודא שנוסחת הציון מחזירה 0 עבור הכנסה שלילית</td>
                <td>קריטי</td>
            </tr>
            <tr>
                <td>AuthController</td>
                <td>וודא שמשתמש חסום לא יכול לקבל Token</td>
                <td>גבוהה</td>
            </tr>
        </table>
        <div class="page-footer">עמוד 22</div>
    </div>

    <div class="page" id="15">
        <h1>15. בקרת גרסאות version control</h1>
        <p>ניהול קוד המקור בפרויקט מתבצע באמצעות מערכת <strong>Git</strong> ומאוחסן בענן בשירות <strong>GitHub</strong>.
        </p>
        <h3>מתודולוגיית העבודה (Branching Strategy):</h3>
        <ul>
            <li><strong>Main Branch:</strong> הגרסה היציבה והנקייה של הפרויקט (Production Ready).</li>
            <li><strong>Dev Branch / Feature Branches:</strong> פיתוח פיצ'רים חדשים נעשה ב"ענפים" נפרדים (למשל
                <code>feature/login-ui</code>), וכאשר הפיצ'ר מוכן, מתבצע מיזוג (Merge) לראשי לאחר בדיקה.
            </li>
        </ul>
        <h3>פעולות נפוצות בשימוש:</h3>
        <ul>
            <li><code>git add .</code> - הוספת קבצים למעקב.</li>
            <li><code>git commit -m "message"</code> - שמירת גרסה מקומית.</li>
            <li><code>git push</code> - העלאת הגרסה ל-GitHub.</li>
        </ul>
        <div class="page-footer">עמוד 23</div>
    </div>

    <!-- CODE APPENDICES - FULL PAGE EXAMPLES -->
    <!-- APPENDICES TOC PAGE -->
    <div class="page" id="appendix">
        <h1>נספחים: דוגמאות קוד</h1>

        <!-- Server Side Header -->
        <h3
            style="margin-bottom: 5px; margin-top: 10px; border-bottom: 2px solid var(--secondary-color); display: inline-block;">
            צד שרת (Server Side)</h3>
        <div class="toc-header">
            <span>נושא</span>
            <span>עמוד</span>
        </div>
        <ul class="toc-list">
            <li class="toc-item"><a href="#app1">1. OCR Service (עיבוד תמונה)</a><span class="toc-page-num">25</span>
            </li>
            <li class="toc-item"><a href="#app2">2. Scoring Logic (לוגיקה עסקית)</a><span class="toc-page-num">26</span>
            </li>
            <li class="toc-item"><a href="#app3">3. Entity Configuration (הגדרת טבלאות)</a><span
                    class="toc-page-num">27</span></li>
            <li class="toc-item"><a href="#app4">4. Admin Controller (ניהול משתמשים)</a><span
                    class="toc-page-num">28</span></li>
            <li class="toc-item"><a href="#app5">5. Database Context (שכבת הנתונים)</a><span
                    class="toc-page-num">29</span></li>
            <li class="toc-item"><a href="#app6">6. JWT Token Generation (אבטחה)</a><span class="toc-page-num">30</span>
            </li>
            <li class="toc-item"><a href="#app7">7. Real-Time Notification (SignalR)</a><span
                    class="toc-page-num">31</span></li>
            <li class="toc-item"><a href="#app8">8. Global Error Handling (Middleware)</a><span
                    class="toc-page-num">32</span></li>
            <li class="toc-item"><a href="#app9">9. Scoring Logic Algorithm</a><span class="toc-page-num">33</span></li>
        </ul>

        <!-- Client Side Header -->
        <h3
            style="margin-bottom: 5px; margin-top: 20px; border-bottom: 2px solid var(--secondary-color); display: inline-block;">
            צד לקוח (Client Side)</h3>
        <div class="toc-header">
            <span>נושא</span>
            <span>עמוד</span>
        </div>
        <ul class="toc-list">
            <li class="toc-item"><a href="#app10">10. Auth Guard (הגנת נתיבים)</a><span class="toc-page-num">34</span>
            </li>
            <li class="toc-item"><a href="#app11">11. Tenant Search Service (חיפוש)</a><span
                    class="toc-page-num">35</span></li>
            <li class="toc-item"><a href="#app12">12. Angular Wizard (ניהול מצב)</a><span class="toc-page-num">36</span>
            </li>
            <li class="toc-item"><a href="#app13">13. Auth Interceptor (הזרקת טוקן)</a><span
                    class="toc-page-num">37</span></li>
            <li class="toc-item"><a href="#app14">14. Dashboard Charts (ויזואליזציה)</a><span
                    class="toc-page-num">38</span></li>
        </ul>

        <div class="page-footer">עמוד 24</div>
    </div>

    <div class="page">
        <h3>1. OCR Service (עיבוד תמונה) - Server Side</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Services/OcrService.cs | <strong>Type:</strong> Server Side (Backend) -->
        <!-- </p> -->
        <pre class="full-code">
// TenantRating.API/Services/OcrService.cs

public async Task&lt;CreateRequestDto&gt; AnalyzePayslipsAsync(List&lt;IFormFile&gt; files)
{
    // Initialize Azure Client
    var credential = new AzureKeyCredential(_apiKey);
    var client = new DocumentIntelligenceClient(new Uri(_endpoint), credential);

    decimal totalNetIncome = 0;
    int count = 0;

    foreach (var file in files)
    {
        // Convert stream to BinaryData
        using var stream = file.OpenReadStream();
        var content = BinaryData.FromStream(stream);
        
        // Call Azure AI Model
        var operation = await client.AnalyzeDocumentAsync(
            WaitUntil.Completed, 
            "prebuilt-document", 
            new AnalyzeDocumentContent() { Base64Source = content }
        );

        // Extract Key Fields via LINQ
        var netField = operation.Value.Documents[0].Fields
            .FirstOrDefault(f => f.Key.Contains("NetIncome"));

        if (netField.Value != null) {
            totalNetIncome += (decimal)netField.Value.AsCurrency().Amount;
            count++;
        }
    }
    
    // Normalize and Return
    return new CreateRequestDto {
        NetIncome = count > 0 ? totalNetIncome / count : 0,
        ProcessedDate = DateTime.Now
    };
}
        </pre>
        <div class="page-footer">עמוד 25</div>
    </div>

    <div class="page">
        <h3>2. Scoring Logic (לוגיקה עסקית) - Server Side</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Services/ScoringService.cs | <strong>Type:</strong> Server Side
            (Backend)</p> -->
        <pre class="full-code">
// TenantRating.API/Services/ScoringService.cs

public decimal CalculateFinalScore(decimal netIncome, decimal rent, int tenureMonths)
{
    // Base Constants
    const decimal BASE_SCORE = 50;
    const decimal MAX_SCORE = 100;
    const decimal MIN_SCORE = 0;

    // 1. Rent-to-Income Calculation
    decimal ratio = rent / netIncome;
    decimal penalty = 0;
    
    if (ratio > 0.35m) // Economic Rule of 35%
    {
        // Strict penalty for high burden
        penalty = (ratio - 0.35m) * 1000; 
    }

    // 2. Tenure Bonus (Logarithmic)
    // We reward stability, but with diminishing returns
    decimal tenureBonus = (decimal)Math.Log(tenureMonths + 1) * 5;

    // 3. Final Aggregation
    decimal calculated = BASE_SCORE - penalty + tenureBonus;
    
    // Clamp result
    return Math.Clamp(calculated, MIN_SCORE, MAX_SCORE);
}
        </pre>
        <div class="page-footer">עמוד 26</div>
    </div>
    <div class="page">
        <h3>3. Entity Configuration (הגדרת טבלאות) - Server Side (EF Core)</h3>
        <!-- <p><strong>File:</strong> TenantRating.Infrastructure/Data/Configurations/RequestConfiguration.cs | <strong>Type:</strong> Server Side (Backend)</p> -->
        <pre class="full-code">
// TenantRating.Infrastructure/Data/Configurations/RequestConfiguration.cs

public class RequestConfiguration : IEntityTypeConfiguration&lt;TenantRequest&gt;
{
    public void Configure(EntityTypeBuilder&lt;TenantRequest&gt; builder)
    {
        // הגדרת שם הטבלה
        builder.ToTable("Requests");

        // הגדרת מפתח ראשי
        builder.HasKey(r => r.Id);

        // הגדרת קשר יחיד-רבים (משתמש אחד -> הרבה בקשות)
        builder.HasOne(r => r.User)
               .WithMany(u => u.Requests)
               .HasForeignKey(r => r.UserId)
               .OnDelete(DeleteBehavior.Cascade); // מחיקת משתמש תמחק את כל בקשותיו

        // הגדרת שדות חובה ודיוק
        builder.Property(r => r.Score)
               .IsRequired()
               .HasColumnType("decimal(18,2)"); // דיוק של 2 ספרות אחרי הנקודה

        builder.Property(r => r.CreatedAt)
               .HasDefaultValueSql("GETDATE()"); // ערך ברירת מחדל
    }
}
        </pre>
        <div class="page-footer">עמוד 27</div>
    </div>


    <div class="page">
        <h3>4. Admin Controller (ניהול משתמשים) - Server Side (Controller)</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Controllers/AdminController.cs | <strong>Type:</strong> Server Side
            (Backend)</p> -->
        <pre class="full-code">
// TenantRating.API/Controllers/AdminController.cs

[Authorize(Roles = "Admin")]
[ApiController]
[Route("api/[controller]")]
public class AdminController : ControllerBase
{
    private readonly IUserService _userService;

    public AdminController(IUserService userService)
    {
        _userService = userService;
    }

    [HttpPost("block/{userId}")]
    public async Task&lt;IActionResult&gt; BlockUser(int userId)
    {
        // חסימת משתמש המפר את תנאי השימוש
        var result = await _userService.ToggleBlockStatusAsync(userId, true);
        if (!result) return NotFound();
        
        return Ok(new { message = "User blocked successfully" });
    }

    [HttpGet("logs")]
    public async Task&lt;IActionResult&gt; GetSystemLogs()
    {
        // שליפת לוגים לצורך ניטור ובקרה
        var logs = await System.IO.File.ReadAllLinesAsync("logs/log.txt");
        return Ok(logs.TakeLast(100)); // החזרת 100 השורות האחרונות
    }
}
        </pre>
        <div class="page-footer">עמוד 28</div>
    </div>

    <div class="page">
        <h3>5. Database Context (שכבת הנתונים) - Server Side (EF Core)</h3>
        <!-- <p><strong>File:</strong> TenantRating.Infrastructure/Data/ApplicationDbContext.cs | <strong>Type:</strong>
            Server Side (Backend)</p> -->
        <pre class="full-code">
// TenantRating.Infrastructure/Data/ApplicationDbContext.cs

public class ApplicationDbContext : DbContext
{
    public ApplicationDbContext(DbContextOptions&lt;ApplicationDbContext&gt; options)
        : base(options) { }

    public DbSet&lt;User&gt; Users { get; set; }
    public DbSet&lt;TenantRequest&gt; Requests { get; set; }
    public DbSet&lt;SavedTenant&gt; SavedTenants { get; set; }

    protected override void OnModelCreating(ModelBuilder builder)
    {
        // הגדרת אינדקס ייחודי למייל
        builder.Entity&lt;User&gt;()
            .HasIndex(u => u.Email)
            .IsUnique();

        // הגדרת מפתח מורכב לטבלת המועדפים
        builder.Entity&lt;SavedTenant&gt;()
            .HasKey(st => new { st.LandlordId, st.TenantId });

        // דיוק דצימלי לציון ולשכר
        builder.Entity&lt;TenantRequest&gt;()
            .Property(r => r.Score)
            .HasColumnType("decimal(18,2)");
    }
}
        </pre>
        <div class="page-footer">עמוד 29</div>
    </div>

    <div class="page">
        <h3>6. JWT Token Generation (אבטחה והזדהות) - Server Side</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Services/AuthService.cs | <strong>Type:</strong> Server Side
            (Backend)</p> -->
        <pre class="full-code">
// TenantRating.API/Services/AuthService.cs

public string GenerateJwtToken(User user)
{
    var jwtKey = _configuration["Jwt:Key"];
    var securityKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(jwtKey));
    var credentials = new SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);

    // הגדרת ה-Claims (מידע המוצפן בתוך הטוקן)
    var claims = new[]
    {
        new Claim(JwtRegisteredClaimNames.Sub, user.Email),
        new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString()),
        new Claim(ClaimTypes.Role, user.Role.ToString()),
        new Claim("UserId", user.Id.ToString())
    };

    // יצירת הטוקן עם תוקף של 4 שעות
    var token = new JwtSecurityToken(
        issuer: _configuration["Jwt:Issuer"],
        audience: _configuration["Jwt:Audience"],
        claims: claims,
        expires: DateTime.Now.AddHours(4),
        signingCredentials: credentials);

    return new JwtSecurityTokenHandler().WriteToken(token);
}
        </pre>
        <div class="page-footer">עמוד 30</div>
    </div>

    <div class="page">
        <h3>7. Real-Time Notification (עדכונים בזמן אמת) - Server Side (SignalR Hub)</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Hubs/NotificationHub.cs | <strong>Type:</strong> Server Side
            (Backend)</p> -->
        <pre class="full-code">
// TenantRating.API/Hubs/NotificationHub.cs

public class NotificationHub : Hub
{
    // פונקציה לשליחת עדכון ללקוח ספציפי
    public async Task SendStatusUpdate(string userId, string status)
    {
        // שימוש ב-SignalR לשליחת הודעה ללא רענון עמוד
        await Clients.User(userId).SendAsync("ReceiveStatus", status);
    }
    
    public override async Task OnConnectedAsync()
    {
        // שיוך אוטומטי של המשתמש לקבוצה לפי ה-ID שלו
        var userId = Context.UserIdentifier;
        if (userId != null)
        {
            await Groups.AddToGroupAsync(Context.ConnectionId, userId);
        }
        await base.OnConnectedAsync();
    }
}
        </pre>
        <div class="page-footer">עמוד 31</div>
    </div>



    <div class="page">
        <h3>8. Global Error Handling (טיפול בשגיאות) - Server Side (Middleware)</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Middleware/ErrorHandlingMiddleware.cs | <strong>Type:</strong> Server
            Side (Backend)</p> -->
        <pre class="full-code">
// TenantRating.API/Middleware/ErrorHandlingMiddleware.cs

public class ErrorHandlingMiddleware
{
    private readonly RequestDelegate _next;
    private readonly ILogger&lt;ErrorHandlingMiddleware&gt; _logger;

    public ErrorHandlingMiddleware(RequestDelegate next, ILogger&lt;ErrorHandlingMiddleware&gt; logger)
    {
        _next = next;
        _logger = logger;
    }

    public async Task Invoke(HttpContext context)
    {
        try
        {
            await _next(context); // המשך לטיפול בבקשה
        }
        catch (Exception ex)
        {
            // לכידת כל שגיאה שלא טופלה בקוד
            _logger.LogError(ex, "Unhandled exception occurred.");
            await HandleExceptionAsync(context, ex);
        }
    }

    private static Task HandleExceptionAsync(HttpContext context, Exception ex)
    {
        var code = HttpStatusCode.InternalServerError;
        // החזרת תשובת JSON אחידה לשגיאות
        var result = JsonSerializer.Serialize(new { error = "Internal Server Error" });
        
        context.Response.ContentType = "application/json";
        context.Response.StatusCode = (int)code;
        return context.Response.WriteAsync(result);
    }
}
        </pre>
        <div class="page-footer">עמוד 32</div>
    </div>

    <div class="page">
        <h3>9. Scoring Logic Algorithm (אלגוריתם הדירוג) - Server Side</h3>
        <!-- <p><strong>File:</strong> TenantRating.API/Logic/RentabilityScoreCalculator.cs | <strong>Type:</strong> Server
            Side (Logic)</p> -->
        <pre class="full-code">
// TenantRating.API/Logic/RentabilityScoreCalculator.cs

public static class RentabilityScoreCalculator
{
    // Risk factors (Haircuts)
    private const decimal KidExpenseFactor = 400m; 
    private const decimal MarriedExpenseFactor = 300m; 
    public const decimal RentToIncomeRatio = 0.35m; 

    public static decimal CalculateTempScore(decimal netIncome, int numChildren, bool isMarried, decimal seniorityYears, decimal pensionGrossAmount)
    {
        decimal tempScore = netIncome;

        // --- 1. Risk Adjustments (Haircuts) ---
        tempScore -= numChildren * KidExpenseFactor;
        if (isMarried) tempScore -= MarriedExpenseFactor;

        // --- 2. Quality Bonuses ---
        if (seniorityYears >= 9) tempScore += seniorityYears * 35m;
        else if (seniorityYears >= 4) tempScore += seniorityYears * 25m;
        else tempScore += seniorityYears * 15m;

        // Pension Bonus
        if (pensionGrossAmount >= 700m) tempScore += 50m;
        else if (pensionGrossAmount >= 400m) tempScore += 20m;

        return Math.Max(0, tempScore);
    }

    public static decimal CalculateFinalScore(decimal tempScore, decimal requestedRent)
    {
        if (requestedRent <= 0) return 100m;
        
        // 1. Max Affordable Rent (35% of Adjusted Income)
        decimal maxAffordableRent = tempScore * RentToIncomeRatio;
        
        // 2. Risk Ratio & Score Conversion
        decimal riskRatio = maxAffordableRent / requestedRent;
        decimal finalScore = riskRatio * 100m;
        
        return Math.Min(Math.Max(finalScore, 0m), 100m);
    }
}
        </pre>
        <div class="page-footer">עמוד 33</div>
    </div>

</body>
<div class="page">
    <h3>10. Auth Guard (הגנת נתיבים בלקוח) - Client Side</h3>
    <!-- <p><strong>File:</strong> TenantRating.Client/src/app/guards/auth.guard.ts | <strong>Type:</strong> Client Side
            (Frontend)</p> -->
    <pre class="full-code">
// TenantRating.Client/src/app/guards/auth.guard.ts

@Injectable({ providedIn: 'root' })
export class AuthGuard implements CanActivate {
  constructor(private auth: AuthService, private router: Router) {}

  canActivate(route: ActivatedRouteSnapshot): boolean {
    const userRole = this.auth.getRole();
    const requiredRole = route.data['role'];

    // בדיקה אם המשתמש מחובר
    if (!this.auth.isLoggedIn()) {
      this.router.navigate(['/login']);
      return false;
    }

    // בדיקת הרשאות (למשל: רק אדמין יכול להיכנס)
    if (requiredRole && userRole !== requiredRole) {
      this.router.navigate(['/unauthorized']);
      return false;
    }

    return true;
  }
}
        </pre>
    <div class="page-footer">עמוד 34</div>
</div>

<div class="page">
    <h3>11. Tenant Search Service (שירות חיפוש) - Client Side</h3>
    <!-- <p><strong>File:</strong> TenantRating.Client/src/app/services/search.service.ts | <strong>Type:</strong> Client
            Side (Frontend)</p> -->
    <pre class="full-code">
// TenantRating.Client/src/app/services/search.service.ts

@Injectable({ providedIn: 'root' })
export class SearchService {
  constructor(private http: HttpClient) {}

  // פונקציה לביצוע חיפוש שוכרים לפי פרמטרים
  searchTenants(criteria: SearchCriteria): Observable&lt;TenantProfile[]&gt; {
    let params = new HttpParams()
        .set('city', criteria.city)
        .set('minScore', criteria.minScore.toString());

    return this.http.get&lt;TenantProfile[]&gt;('/api/landlord/search', { params }).pipe(
      // סינון נוסף בצד הלקוח אם נדרש
      map(tenants => tenants.filter(t => t.isActive)),
      catchError(this.handleError)
    );
  }

  private handleError(error: any) {
    console.error('Search failed', error);
    return throwError(() => new Error('Search failed'));
  }
}
        </pre>
    <div class="page-footer">עמוד 35</div>
</div>

<div class="page">
    <h3>12. Angular Wizard (ניהול מצב בלקוח) - Client Side</h3>
    <!-- <p><strong>File:</strong> TenantRating.Client/src/app/wizard/tenant-wizard.component.ts | <strong>Type:</strong>
            Client Side (Frontend)</p> -->
    <pre class="full-code">
// tenant-wizard.component.ts

export class TenantWizardComponent {
  currentStep = 1;
  requestData = { rent: 0, city: '' };

  nextStep() {
    if (!this.validateStep(this.currentStep)) return;

    if (this.currentStep === 2) {
      // Async Upload
      this.isProcessing = true;
      this.apiService.uploadDocs(this.files).subscribe({
        next: (res) => {
            this.systemScore = res.score;
            this.currentStep++; // Move to result
        },
        error: (err) => this.errorHandler(err),
        complete: () => this.isProcessing = false
      });
    } else {
      this.currentStep++;
    }
  }

  calculateProgress(): number {
    // Return percentage for progress bar
    return (this.currentStep / 4) * 100;
  }
}
        </pre>
    <div class="page-footer">עמוד 36</div>
</div>

</body>

<!-- NEW CLIENT SNIPPET 1 -->
<div class="page" id="app13">
    <h3>13. Auth Interceptor (הזרקת טוקן) - Client Side</h3>
    <pre class="full-code">
// TenantRating.Client/src/app/core/auth.interceptor.ts

@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  constructor(private authService: AuthService) {}

  intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    // שליפת הטוקן מה-Local Storage
    const token = this.authService.getToken();

    if (token) {
      // שכפול הבקשה והוספת כותרת Authorization
      const cloned = req.clone({
        headers: req.headers.set('Authorization', `Bearer ${token}`)
      });
      return next.handle(cloned);
    }

    // אם אין טוקן, שלח את הבקשה כמו שהיא
    return next.handle(req);
  }
}
        </pre>
    <div class="page-footer">עמוד 37</div>
</div>

<!-- NEW CLIENT SNIPPET 2 -->
<div class="page" id="app14">
    <h3>14. Dashboard Charts (ויזואליזציה) - Client Side</h3>
    <pre class="full-code">
// dashboard.component.ts (שימוש ב-Ngx-Charts)

@Component({
  selector: 'app-dashboard',
  template: `
    &lt;ngx-charts-bar-vertical
      [view]="[700, 400]"
      [results]="chartData"
      [xAxis]="true"
      [yAxis]="true"
      [legend]="true"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      xAxisLabel="חודש"
      yAxisLabel="ציון ממוצע"&gt;
    &lt;/ngx-charts-bar-vertical&gt;
  `
})
export class DashboardComponent implements OnInit {
  chartData: any[] = [];

  constructor(private statsService: StatsService) {}

  ngOnInit() {
    // טעינת נתונים לגרף מהשרת
    this.statsService.getMonthlyStats().subscribe(data => {
      this.chartData = data.map(item => ({
        name: item.monthName,
        value: item.averageScore
      }));
    });
  }
}
        </pre>
    <div class="page-footer">עמוד 38</div>
</div>
</body>

</html>